var mdTemplatePreview={init:function(){this.container=$("#preview-container"),this.stateSelect=$("#preview-version",this.container),this.selectedState="draft",this.selectedType="html",this.template=null;var e=this;$("#hide-preview",this.container).click(function(t){t.preventDefault(),e.container.removeClass("overlay-visible"),$("body").removeClass("y-hidden"),e.reset()}),this.stateSelect.change(function(t){t.preventDefault();var i=e.selectedType;e.selectedState=$(this).val(),"publish"==e.selectedState?e.hasPublishedHtml()?e.hasPublishedText()||($("#show-preview-text",e.container).prop("disabled",!0),i="html"):($("#show-preview-html",e.container).prop("disabled",!0),i="text"):$("button.type-toggle",e.container).prop("disabled",!1),$("#show-preview-"+i,e.container).trigger("click")}),$("button.type-toggle",this.container).click(function(t){t.preventDefault();var i=$(this).val();return $(this).is(":disabled")?!1:($("iframe.preview-frame",e.container).removeClass("active-frame"),$("iframe."+i+"."+e.selectedState,e.container).addClass("active-frame"),$("button.type-toggle",e.container).removeClass("btn-selected"),$(this).addClass("btn-selected"),void(e.selectedType=i))}),$("button.media-toggle",this.container).click(function(t){t.preventDefault(),$(".media-container",e.container).removeClass("active-media"),$("#"+$(this).val()+"-preview",e.container).addClass("active-media"),$("button.media-toggle",e.container).removeClass("btn-selected"),$(this).addClass("btn-selected")});var t=function(){var e=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,t=$("#desktop-preview",this.container),i=e-t.offset().top-20;t.height(i).find("iframe").height(i)};return $(window).resize(t),t(),this.reset()},getDraftedText:function(){return this.template.text},getDraftedHtml:function(){return this.template.html},hasPublishedHtml:function(){return""!=this.template.publishedHtml&&null!=this.template.publishedHtml},hasPublishedText:function(){return""!=this.template.publishedText&&null!=this.template.publishedText},reset:function(){return this.selectedState="draft",this.selectedType="html",this.template=null,this.stateSelect.find("option.preview-published").remove(),this.stateSelect.val(this.selectedState).trigger("change"),$("#show-desktop-preview",this.container).trigger("click"),this},loadFrames:function(){var e=this;return $("iframe.preview-frame",this.container).each(function(t,i){var s=$(i).data(),a=i.contentDocument||i.contentWindow.document,n='<pre style="white-space:pre-wrap; white-space:-moz-pre-wrap; white-space:-pre-wrap; white-space:-o-pre-wrap; word-wrap:break-word;">';a.open(),a.write("publish"==s.state?"text"==s.type?n+e.template.publishedText+"</pre>":e.template.publishedHtml:"text"==s.type?n+e.getDraftedText()+"</pre>":e.getDraftedHtml()),a.close()}),this},show:function(e,t){this.template=e;var i=$('<option class="preview-published" />');return this.hasPublishedText()||this.hasPublishedHtml()?i.text("Published version").val("publish").appendTo(this.stateSelect):i.text("No published version").prop("disabled",!0).appendTo(this.stateSelect),t===!0&&$("#edit-template",this.container).attr("href","/templates/code?id="+this.template.slug).show(),$("#preview-name",this.container).html(this.template.name),this.loadFrames(),this.container.addClass("overlay-visible"),$("body").addClass("y-hidden"),this}};