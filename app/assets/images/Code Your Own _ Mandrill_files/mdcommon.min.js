var md={};md.popup=function(e,t,a){var o="toolbar=0,scrollbars=1,location=1,status=1,menubar=0,resizable=1";t&&a&&(o+=",width="+t+",height="+a);window.open(e,"_blank",o)},md.toast=function(e,t){t=t||"success",$("#flash div.flash-toast").remove();var a=$("<div></div>").addClass("flash-"+t).addClass("flash-block").addClass("flash-toast").addClass(t).text(e);$("#flash").append(a),setTimeout(function(){a.hide(600,function(){$(this).remove()})},3e3)},md.requireConfirm=function(e,t,a,o,n){e=$(e),$(o).text(n.replace("*|REQUIRE|*",a)),e.attr("disabled",!0),$(t).bind("keyup",function(){e.attr("disabled",$(this).val()!=a)})},md.checkSudoSession=function(e){return Math.floor((new Date).getTime()/1e3)>=_sudo_time?($("#sudo-referrer").val(e),$("#sudo-password").val(""),$("#sudo-dialog").dialog("open"),!1):!0},md.logDebugInfo=function(){for(var e="",t=1;$.cookie("dbard"+t);)e+=$.cookie("dbard"+t).replace(/\+/g," "),t++;try{e=JSON.parse(e),console.log("Request time: "+(1e3*e.timing[0].stop).toFixed(1)+"ms"),$.each(e.logs,function(e,t){console.log(t)})}catch(a){console.log("Error logging debug info",a)}};var mdlog={};mdlog.log=function(e,t,a){$.post("/log",{msg:e,name:t,level:a}).fail(function(){console.log("Couldn't write message to "+a+" log.",e)})},mdlog.debug=function(e,t){mdlog.log(e,t,"debug")},mdlog.info=function(e,t){mdlog.log(e,t,"info")},mdlog.warn=function(e,t){mdlog.log(e,t,"warn")},mdlog.error=function(e,t){mdlog.log(e,t,"error")},mdlog.err=function(e,t){mdlog.error(e,t)},mdlog.crit=function(e,t){mdlog.log(e,t,"crit")};var mddate={};mddate.month_labels=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],mddate.formatDateTime=function(e){return mddate.formatDate(e)+" "+mddate.formatTime(e)},mddate.formatDate=function(e){return mddate.month_labels[e.getMonth()]+" "+e.getDate()+", "+e.getFullYear()},mddate.formatTime=function(e){var t=e.getHours(),a="am";return t>12?(t-=12,a="pm"):12==t?a="pm":0==t&&(t=12),t+":"+mddate.zeroFill(e.getMinutes())+" "+a},mddate.dateOnly=function(e){var t=new Date(1e3*e);return new Date(t.getFullYear(),t.getMonth(),t.getDate())},mddate.zeroFill=function(e,t){for(t=t||2,e+="";e.length<t;)e="0"+e;return e},mddate.parseDateUTC=function(e){if(null==e)return null;var t=e.split(/[\s-:.]/).map(function(e){return parseInt(e,10)});return t.length>1&&(t[1]-=1),new Date(Date.UTC.apply(null,t.slice(0,7)))},mddate.shortFormat=function(){var e=new Date(2013,0,2);return"1/2/213"==e.toLocaleDateString().replace(/0/g,"")?"mm/dd/yy":"dd/mm/yy"},mddate.initshortdate=function(e){$(e).each(function(){var e="input"==this.nodeName.toLowerCase()?"val":"text",t=$(this),a=t[e]().split("-");if("mm/dd/yy"==mddate.shortFormat())var o=a[1]+"/"+a[2]+"/"+a[0];else var o=a[2]+"/"+a[1]+"/"+a[0];t[e](o)})},mddate.initlocal=function(e){$(e).each(function(){var e=$(this);e.text(mddate.formatDateTime(new Date(1e3*parseInt(e.text()))))})};var mdsearchselect={};mdsearchselect.search=function(e){mdsearchselect.open(e),$.getJSON(e.attr("data-searchurl"),{q:e.find(".searchinput").val()},function(t){var a=e.find(".search-select-options");$.each(t,function(t,o){a.append($("<li />").attr("data-tagid",o.id).text(o.taglabel).click(function(){mdsearchselect.select(e,$(this).attr("data-tagid"),$(this).text())}))})})},mdsearchselect.select=function(e,t,a){var o=e.parents(".search-select-form").find("select");o.find("option").remove(),o.append($("<option />").attr("value",t).text(a)),o.val(t),mdsearchselect.close(e),o.change()},mdsearchselect.open=function(e){e.show().find("li").remove(),$(document).on("keyup.mdsearchselect",function(t){27==t.keyCode&&mdsearchselect.close(e)}),$(".search-select-form").on("click.mdsearchselect",function(e){e.stopPropagation()}),$(document).on("click.mdsearchselect",function(t){return mdsearchselect.close(e),t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),!1})},mdsearchselect.close=function(e){e.hide(),$(document).off(".mdsearchselect")},$(function(){mddate.initlocal("span.localdate"),mddate.initshortdate(".short-date"),$("input[type=hidden][name=date_format]").each(function(){$(this).val(mddate.shortFormat())})}),$(document).ready(function(){$("html").click(function(){$(".drop-trigger").removeClass("active"),$(".button-split").removeClass("drop-show")}),$(document).on("click",".drop-trigger",function(e){e.stopPropagation(),$(this).hasClass("active")?($(".drop-trigger").removeClass("active"),$(this).closest(".button-split").removeClass("drop-show")):($(".drop-trigger").removeClass("active"),$(".button-split").removeClass("drop-show"),$(this).addClass("active"),$(this).closest(".button-split").addClass("drop-show"))}),$(".search-select-form select").live("focus",function(){var e=$(this).parents(".search-select-form").find(".search-select");return e.find("input.searchinput").val(""),this.multiple=!0,this.blur(),setTimeout('$(".search-select-form select").attr("multiple", false)',0),mdsearchselect.search(e),!1}),$(".search-select-form input.searchinput").keypress(function(e){return 13==e.keyCode?(mdsearchselect.search($(this).parents(".search-select-form").find(".search-select")),e.preventDefault(),e.stopPropagation(),!1):void 0}),$(".search-select-form button").click(function(e){return e.preventDefault(),mdsearchselect.search($(this).parents(".search-select-form").find(".search-select")),!1}),$.cookie&&$.cookie("dbard1")&&md.logDebugInfo(),md.creditCardIcon=function(){var e=$("#cc-num").val(),t=document.getElementById("cc-icon");e.match("^4")?(t.className="visa",$("#cc-icon").fadeIn("fast")):e.match("^3[47]")?(t.className="amex",$("#cc-icon").fadeIn("fast")):e.match("^6(?:011|5)")?(t.className="discover",$("#cc-icon").fadeIn("fast")):e.match("^5[1-5]")?(t.className="mastercard",$("#cc-icon").fadeIn("fast")):$("#cc-icon").fadeOut("fast")},$("#cc-num").bind("keyup blur",function(){md.creditCardIcon()})});